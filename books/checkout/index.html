<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Judaica World Books - Checkout</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet">
  <link href="checkout.css" rel="stylesheet">
  <link href="../main.css" rel="stylesheet">
  <link rel="icon" href="https://www.judaica-world.com/media/favicon/default/favicon_2__1.jpg" type="image/x-icon">
  <link rel="shortcut icon" href="https://www.judaica-world.com/media/favicon/default/favicon_2__1.jpg" type="image/x-icon">
</head>
<body>
  <header>
    <div class="container">
      <a href="/" class="logo"><img src="../public/uploads/judaica-world_logo.png" alt="judaica-world_logo" class="logo-image"></a>
    </div>
  </header>

  <div class="container">
    <h1>Checkout</h1>
    
    <div class="checkout-container">
      <div class="order-summary">
        <h2>Order Summary</h2>
        
        <div id="order-summary-content">
          <!-- Order summary content will be dynamically added here -->
        </div>
        <div class="order-subtotal">
          <span>Subtotal:</span>
          <span id="subtotal-cost"></span>
        </div>
        <div class="order-tax">
          <span>Tax (8.875%):</span>
          <span id="tax-amount"></span>
        </div>
        <div class="order-shipping">
          <span>Shipping:</span>
          <span id="shipping-cost"></span>
        </div>
        <div class="order-total">
          <span>Total:</span>
          <span id="total-cost"></span>
        </div>
      </div>

      <div class="shipping-payment-form">
        <h2>Shipping Options</h2>
        <div class="shipping-options">
          <div class="shipping-option selected" data-cost="0" id="pickup-option">
            <i class="fas fa-store"></i>
            <p>Store Pickup</p>
            <p>Free</p>
          </div>
          <div class="shipping-option" data-cost="5.99" id="delivery-option">
            <i class="fas fa-truck"></i>
            <p>Shipping</p>
            <p>$5.99</p>
          </div>
        </div>

        <h2>Shipping Information</h2>
        <form id="shipping-payment-form">
          <div class="form-row">
            <div class="form-group">
              <label for="name">Full Name</label>
              <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
              <label for="email">Email</label>
              <input type="email" id="email" name="email" required>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="phone">Phone Number</label>
              <input type="tel" id="phone" name="phone" required>
            </div>
            <div class="form-group">
              <label for="zip">ZIP Code</label>
              <input type="text" id="zip" name="zip" required>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group form-group-full">
              <label for="address">Address</label>
              <input type="text" id="address" name="address" required>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="city">City</label>
              <input type="text" id="city" name="city" required>
            </div>
            <div class="form-group">
              <label for="state">State</label>
              <select id="state" name="state" required>
                <option value="">Select State</option>
                <option value="AL">Alabama</option>
                <option value="AK">Alaska</option>
                <option value="AZ">Arizona</option>
                <!-- Add more states here -->
              </select>
            </div>
          </div>
          
          <h2>Payment Information</h2>
          <div class="payment-options">
            <div class="payment-option selected" id="credit-card-option">
              <i class="fas fa-credit-card"></i>
              <p>Credit Card</p>
            </div>
            <div class="payment-option" id="phone-option">
              <i class="fas fa-phone"></i>
              <p>Pay by Phone</p>
            </div>
          </div>

          <div id="credit-card-form">
            <div class="form-row">
              <div class="form-group form-group-full">
                <label for="card-number">Card Number</label>
                <input type="text" id="card-number" name="card-number">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="expiry">Expiration Date</label>
                <input type="text" id="expiry" name="expiry" placeholder="MM/YY">
              </div>
              <div class="form-group">
                <label for="cvv">CVV</label>
                <input type="text" id="cvv" name="cvv">
              </div>
            </div>
          </div>

          <div id="phone-payment-info">
            <p>To pay by phone, please call us at 1-800-BOOKS-4-KIDS (1-800-266-5745).</p>
            <p>Our customer service representatives are available Monday through Friday, 9am to 5pm EST.</p>
            <p>Please have your order number ready when you call.</p>
          </div>

          <button type="submit" class="btn">Complete Purchase</button>
        </form>
      </div>
    </div>
  </div>

  <div id="thank-you-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Thank You for Your Purchase!</h2>
      <p>Your order has been successfully processed.</p>
      <p>Order number: <span id="order-number"></span></p>
      <p>We'll send a confirmation email to <span id="confirm-email"></span> shortly.</p>
    </div>
  </div>

  <footer>
    <div class="container">
      <p style="margin: 0;">&copy; 2024 Judaica World. All rights reserved.</p>
    </div>
  </footer>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    $(document).ready(function() {
      // let orderData = JSON.parse(localStorage.getItem('orderData') ?? '{"children":[{"name":"kjnkfdvd","school":"roosevelt-high","grade":"2"}],"cart":[{"id":203,"title":"Our Planet Earth","price":26.99,"child":"kjnkfdvd"},{"id":202,"title":"Reading Comprehension: Grade 2","price":17.99,"child":"kjnkfdvd"}]}');
      let orderData = JSON.parse(localStorage.getItem('orderData'));
      const TAX_RATE = 0.08875; // 8.875%
      let SUBTOTAL = 0;
      let TOTAL = 0;

      // Function to update the order summary content
      function updateOrderSummary() {
        const orderSummaryContent = $('#order-summary-content');
        orderSummaryContent.empty(); // Clear previous content

        let subtotal = 0;

        orderData.children.forEach(child => {
          const childOrder = $('<div class="child-order"></div>');
          childOrder.append(`<div class="child-name">${child.name} - ${child.grade} Grade</div>`);

          const cartItems = orderData.cart.filter(item => item.child === child.name);
          cartItems.forEach(item => {
            const orderItem = $('<div class="order-item"></div>');
            orderItem.append(`<span>${item.title}</span>`);
            orderItem.append(`<span>$${item.price.toFixed(2)}</span>`);
            childOrder.append(orderItem);
            subtotal += parseFloat(item.price);
          });
          SUBTOTAL =+ subtotal;
          childOrder.append(`<div class="child-subtotal">Subtotal: $${subtotal.toFixed(2)}</div>`);
          orderSummaryContent.append(childOrder);
          subtotal = 0; // Reset subtotal for the next child
        });
      }

      $('.payment-option').click(function() {
        $('.payment-option').removeClass('selected');
        $(this).addClass('selected');
        
        if ($(this).attr('id') === 'credit-card-option') {
          $('#credit-card-form').show();
          $('#phone-payment-info').hide();
        } else {
          $('#credit-card-form').hide();
          $('#phone-payment-info').show();
        }
      });

      $('.shipping-option').click(function() {
        $('.shipping-option').removeClass('selected');
        $(this).addClass('selected');
        updateTotal();
      });

      function updateTotal() {
        let tax = SUBTOTAL * TAX_RATE;
        let shippingCost = 5.99;
        TOTAL = SUBTOTAL + tax + shippingCost;

        $('#tax-amount').text('$' + tax.toFixed(2));
        $('#shipping-cost').text('$' + shippingCost.toFixed(2));
        $('#total-cost').text('$' + TOTAL.toFixed(2));
      }

      $('#shipping-payment-form').submit(function(e) {
        e.preventDefault();

        // Get form data
        const name = $('#name').val(), email = $('#email').val(), phone = $('#phone').val(), zip = $('#zip').val(), address = $('#address').val(), city = $('#city').val(), state = $('#state').val();
        const paymentMethod = $('.payment-option.selected').attr('id');

        // Create form data object
        const formData = { name, email, phone, zip, address, city, state, paymentMethod, total: TOTAL.toFixed(2) };

        // Get existing orderData from localStorage
        let orderData = JSON.parse(localStorage.getItem('orderData'));

        // Add form data to orderData
        orderData.formData = formData;

        // Update orderData in localStorage
        localStorage.setItem('orderData', JSON.stringify(orderData));

        // Generate order number
        let orderNumber = 'ORD-' + Math.random().toString(36).substr(2, 9).toUpperCase();
        $('#order-number').text(orderNumber);
        $('#confirm-email').text($('#email').val());
        $('#thank-you-modal').css('display', 'block');
      });

      $('.close').click(function() {
        $('#thank-you-modal').css('display', 'none');
      });

      $(window).click(function(event) {
        if (event.target == document.getElementById('thank-you-modal')) {
          $('#thank-you-modal').css('display', 'none');
        }
      });

      // Initial update
      updateOrderSummary();
      updateTotal();
    });
  </script>
</body>
</html>
