<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SchoolBookExpress Admin - Orders Management</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" rel="stylesheet">
    <link href="styles.css" rel="stylesheet">
    <link rel="icon" href="https://www.judaica-world.com/media/favicon/default/favicon_2__1.jpg" type="image/x-icon">
    <link rel="shortcut icon" href="https://www.judaica-world.com/media/favicon/default/favicon_2__1.jpg" type="image/x-icon">
  </head>
  <body>
    <header>
      <div class="container">
        <a href="/" class="logo"><img src="../../public/uploads/judaica-world_logo.png" alt="judaica-world_logo" class="logo-image"></a>
        <nav>
          <ul>
            <li><a href="/admin"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
            <li><a href="/admin/books"><i class="fas fa-book"></i> Books</a></li>
            <li><a href="/admin/orders"><i class="fas fa-shopping-cart"></i> Orders</a></li>
            <li><a href="/admin/users"><i class="fas fa-users"></i> Users</a></li>
            <li><a href="/admin/settings"><i class="fas fa-cog"></i> Settings</a></li>
            <li><a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a></li>
          </ul>
        </nav>
      </div>
    </header>
      
    <div class="container">
      <h1>Manage Books</h1>
      
      <div class="filters">
        <button class="add-book-btn"><i class="fas fa-plus"></i> Add New Book</button>
        <div class="search-bar">
          <input type="text" placeholder="Search books...">
          <button class="btn"><i class="fas fa-search"></i></button>
        </div>
        <div class="category-filter">
          <select>
            <option value="">All Categories</option>
            <option value="fiction">Fiction</option>
            <option value="non-fiction">Non-Fiction</option>
            <option value="science">Science</option>
            <option value="history">History</option>
            <option value="math">Mathematics</option>
          </select>
        </div>
        <div>
          <label for="rows-per-page">Rows per page:</label>
          <select id="rows-per-page">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50">50</option>
            <option value="100">100</option>
          </select>
        </div>
        <button class="export-btn"><i class="fas fa-file-export"></i> Export</button>
      </div>
  
      <table id="books-table">
        <thead>
          <tr>
            <th>
              ISBN
              <i class="fas fa-sort sort-icon" data-column="isbn"></i>
              <span class="column-filter">
                <i class="fas fa-filter column-filter-icon" data-column="isbn"></i>
                <div class="column-filter-dropdown">
                  <input type="text" placeholder="Filter ISBN">
                  <button>Apply</button>
                </div>
              </span>
            </th>
            <th>
              Title
              <i class="fas fa-sort sort-icon" data-column="title"></i>
              <span class="column-filter">
                <i class="fas fa-filter column-filter-icon" data-column="title"></i>
                <div class="column-filter-dropdown">
                  <input type="text" placeholder="Filter Title">
                  <button>Apply</button>
                </div>
              </span>
            </th>
            <th>
              Author
              <i class="fas fa-sort sort-icon" data-column="author"></i>
              <span class="column-filter">
                <i class="fas fa-filter column-filter-icon" data-column="author"></i>
                <div class="column-filter-dropdown">
                  <input type="text" placeholder="Filter Author">
                  <button>Apply</button>
                </div>
              </span>
            </th>
            <th>
              Category
              <i class="fas fa-sort sort-icon" data-column="category"></i>
              <span class="column-filter">
                <i class="fas fa-filter column-filter-icon" data-column="category"></i>
                <div class="column-filter-dropdown">
                  <select>
                    <option value="">All Categories</option>
                    <option value="fiction">Fiction</option>
                    <option value="non-fiction">Non-Fiction</option>
                    <option value="science">Science</option>
                    <option value="history">History</option>
                    <option value="math">Mathematics</option>
                  </select>
                  <button>Apply</button>
                </div>
              </span>
            </th>
            <th>
              Price
              <i class="fas fa-sort sort-icon" data-column="price"></i>
              <span class="column-filter">
                <i class="fas fa-filter column-filter-icon" data-column="price"></i>
                <div class="column-filter-dropdown">
                  <input type="number" placeholder="Min Price">
                  <input type="number" placeholder="Max Price">
                  <button>Apply</button>
                </div>
              </span>
            </th>
            <th>
              Stock
              <i class="fas fa-sort sort-icon" data-column="stock"></i>
              <span class="column-filter">
                <i class="fas fa-filter column-filter-icon" data-column="stock"></i>
                <div class="column-filter-dropdown">
                  <input type="number" placeholder="Min Stock">
                  <input type="number" placeholder="Max Stock">
                  <button>Apply</button>
                </div>
              </span>
            </th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <!-- Table rows will be dynamically populated here -->
        </tbody>
      </table>
  
      <div class="pagination">
        <a href="#" class="btn" id="prev-page"><i class="fas fa-chevron-left"></i> Previous</a>
        <span id="page-info">Page 1 of 1</span>
        <a href="#" class="btn" id="next-page">Next <i class="fas fa-chevron-right"></i></a>
      </div>
    </div>
  
    <!-- View Book Modal -->
    <div id="viewBookModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Book Details</h2>
          <span class="close">&times;</span>
        </div>
        <div id="bookDetails" class="book-details">
          <!-- Book details will be dynamically populated here -->
        </div>
        <div class="book-actions">
          <button class="btn btn-edit" id="editBookBtn"><i class="fas fa-edit"></i> Edit</button>
          <button class="btn btn-delete" id="deleteBookBtn"><i class="fas fa-trash"></i> Delete</button>
        </div>
      </div>
    </div>
  
    <!-- Edit Book Modal -->
    <div id="editBookModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Edit Book</h2>
          <span class="close">&times;</span>
        </div>
        <form id="editBookForm">
          <div class="form-group">
            <label for="editIsbn">ISBN:</label>
            <input type="text" id="editIsbn" required>
          </div>
          <div class="form-group">
            <label for="editTitle">Title:</label>
            <input type="text" id="editTitle" required>
          </div>
          <div class="form-group">
            <label for="editAuthor">Author:</label>
            <input type="text" id="editAuthor" required>
          </div>
          <div class="form-group">
            <label for="editCategory">Category:</label>
            <select id="editCategory" required>
              <option value="fiction">Fiction</option>
              <option value="non-fiction">Non-Fiction</option>
              <option value="science">Science</option>
              <option value="history">History</option>
              <option value="math">Mathematics</option>
            </select>
          </div>
          <div class="form-group">
            <label for="editPrice">Price:</label>
            <input type="number" id="editPrice" step="0.01" required>
          </div>
          <div class="form-group">
            <label for="editStock">Stock:</label>
            <input type="number" id="editStock" required>
          </div>
          <div class="form-group full-width">
            <label for="editDescription">Description:</label>
            <textarea id="editDescription" required></textarea>
          </div>
          <div class="form-group full-width">
            <label for="editCoverImage">Cover Image URL:</label>
            <input type="url" id="editCoverImage">
          </div>
          <button type="submit" id="updateBookBtn" class="btn">Update Book</button>
        </form>
      </div>
    </div>
  
    <!-- Add Book Modal -->
    <div id="addBookModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add New Book</h2>
          <span class="close">&times;</span>
        </div>
        <form id="addBookForm">
          <div class="form-group">
            <label for="addIsbn">ISBN:</label>
            <input type="text" id="addIsbn" required>
          </div>
          <div class="form-group">
            <label for="addTitle">Title:</label>
            <input type="text" id="addTitle" required>
          </div>
          <div class="form-group">
            <label for="addAuthor">Author:</label>
            <input type="text" id="addAuthor" required>
          </div>
          <div class="form-group">
            <label for="addCategory">Category:</label>
            <select id="addCategory" required>
              <option value="fiction">Fiction</option>
              <option value="non-fiction">Non-Fiction</option>
              <option value="science">Science</option>
              <option value="history">History</option>
              <option value="math">Mathematics</option>
            </select>
          </div>
          <div class="form-group">
            <label for="addPrice">Price:</label>
            <input type="number" id="addPrice" step="0.01" required>
          </div>
          <div class="form-group">
            <label for="addStock">Stock:</label>
            <input type="number" id="addStock" required>
          </div>
          <div class="form-group">
            <label for="addDescription">Description:</label>
            <textarea id="addDescription" required></textarea>
          </div>
          <div class="form-group">
            <label for="addCoverImage">Cover Image URL:</label>
            <input type="url" id="addCoverImage">
          </div>
          <button type="submit" id="addBookBtn" class="btn">Add Book</button>
        </form>
      </div>
    </div>
  
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
      $(document).ready(function() {
        const booksData = [
          {
            isbn: "9780061120084",
            title: "To Kill a Mockingbird",
            author: "Harper Lee",
            category: "Fiction",
            price: 12.99,
            stock: 50,
            description: "The unforgettable novel of a childhood in a sleepy Southern town and the crisis of conscience that rocked it.",
            coverImage: "https://example.com/to-kill-a-mockingbird-cover.jpg"
          },
          {
            isbn: "9780743273565",
            title: "The Great Gatsby",
            author: "F. Scott Fitzgerald",
            category: "Fiction",
            price: 15.99,
            stock: 35,
            description: "A portrait of the Jazz Age in all of its decadence and excess, Gatsby captured the spirit of the author's generation.",
            coverImage: "https://example.com/the-great-gatsby-cover.jpg"
          },
          {
            isbn: "9780385490818",
            title: "The Catcher in the Rye",
            author: "J.D. Salinger",
            category: "Fiction",
            price: 14.99,
            stock: 40,
            description: "The hero-narrator of The Catcher in the Rye is an ancient child of sixteen, a native New Yorker named Holden Caulfield.",
            coverImage: "https://example.com/the-catcher-in-the-rye-cover.jpg"
          },
          {
            isbn: "9780142000670",
            title: "Of Mice and Men",
            author: "John Steinbeck",
            category: "Fiction",
            price: 11.99,
            stock: 25,
            description: "A controversial tale of friendship and tragedy during the Great Depression.",
            coverImage: "https://example.com/of-mice-and-men-cover.jpg"
          },
          {
            isbn: "9780060850524",
            title: "Brave New World",
            author: "Aldous Huxley",
            category: "Science Fiction",
            price: 13.99,
            stock: 30,
            description: "Aldous Huxley's profoundly important classic of world literature, Brave New World is a searching vision of an unequal, technologically-advanced future where humans are genetically bred, socially indoctrinated, and pharmaceutically anesthetized to passively uphold an authoritarian ruling order.",
            coverImage: "https://example.com/brave-new-world-cover.jpg"
          }
        ];
  
        let currentPage = 1;
        let rowsPerPage = 10;
        let sortColumn = 'title';
        let sortOrder = 'asc';
        let filters = {};
  
        function renderTable() {
          const tableBody = $('#books-table tbody');
          tableBody.empty();
  
          let filteredData = booksData.filter(book => {
            return Object.keys(filters).every(key => {
              if (!filters[key]) return true;
              if (key === 'price' || key === 'stock') {
                const [min, max] = filters[key];
                const value = parseFloat(book[key]);
                return (!min || value >= min) && (!max || value <= max);
              }
              return book[key].toString().toLowerCase().includes(filters[key].toLowerCase());
            });
          });
  
          filteredData.sort((a, b) => {
            if (a[sortColumn] < b[sortColumn]) return sortOrder === 'asc' ? -1 : 1;
            if (a[sortColumn] > b[sortColumn]) return sortOrder === 'asc' ? 1 : -1;
            return 0;
          });
  
          const startIndex = (currentPage - 1) * rowsPerPage;
          const endIndex = startIndex + rowsPerPage;
          const pageData = filteredData.slice(startIndex, endIndex);
  
          pageData.forEach(book => {
            const stockStatus = book.stock > 20 ? 'in-stock' : (book.stock > 0 ? 'low-stock' : 'out-of-stock');
            const stockText = book.stock > 20 ? 'In Stock' : (book.stock > 0 ? 'Low Stock' : 'Out of Stock');
            const row = `
              <tr>
                <td>${book.isbn}</td>
                <td>${book.title}</td>
                <td>${book.author}</td>
                <td>${book.category}</td>
                <td>$${book.price.toFixed(2)}</td>
                <td><span class="stock-badge ${stockStatus}">${stockText} (${book.stock})</span></td>
                <td class="action-buttons">
                  <button class="btn btn-view" data-isbn="${book.isbn}"><i class="fas fa-eye"></i> View</button>
                  <button class="btn btn-edit" data-isbn="${book.isbn}"><i class="fas fa-edit"></i> Edit</button>
                  <button class="btn btn-delete" data-isbn="${book.isbn}"><i class="fas fa-trash"></i> Delete</button>
                </td>
              </tr>
            `;
            tableBody.append(row);
          });
  
          updatePagination(filteredData.length);
        }
  
        function updatePagination(totalItems) {
          const totalPages = Math.ceil(totalItems / rowsPerPage);
          $('#page-info').text(`Page ${currentPage} of ${totalPages}`);
          $('#prev-page').toggleClass('disabled', currentPage === 1);
          $('#next-page').toggleClass('disabled', currentPage === totalPages);
        }
  
        function showBookDetails(isbn) {
          const book = booksData.find(b => b.isbn === isbn);
          if (book) {
            const detailsHtml = `
              <div class="book-cover">
                <img src="${book.coverImage}" alt="${book.title} cover" width="200">
              </div>
              <h3>Title: ${book.title}</h3>
              <p><strong>Author:</strong> ${book.author}</p>
              <p><strong>ISBN:</strong> ${book.isbn}</p>
              <p><strong>Category:</strong> ${book.category}</p>
              <p><strong>Price:</strong> $${book.price.toFixed(2)}</p>
              <p><strong>Stock:</strong> ${book.stock}</p>
              <h3>Description</h3>
              <p>${book.description}</p>
            `;
            $('#bookDetails').html(detailsHtml);
            $('#viewBookModal').css('display', 'block');
          }
        }
  
        function populateEditForm(isbn) {
          const book = booksData.find(b => b.isbn === isbn);
          if (book) {
            $('#editIsbn').val(book.isbn);
            $('#editTitle').val(book.title);
            $('#editAuthor').val(book.author);
            $('#editCategory').val(book.category);
            $('#editPrice').val(book.price);
            $('#editStock').val(book.stock);
            $('#editDescription').val(book.description);
            $('#editCoverImage').val(book.coverImage);
            $('#editBookModal').css('display', 'block');
          }
        }
  
        // Event Listeners
        $('#books-table').on('click', '.btn-view', function() {
          const isbn = $(this).data('isbn');
          showBookDetails(isbn);
        });
  
        $('#books-table').on('click', '.btn-edit', function() {
          const isbn = $(this).data('isbn');
          populateEditForm(isbn);
        });
  
        $('.close').click(function() {
          $('.modal').css('display', 'none');
        });
  
        $(window).click(function(event) {
          if ($(event.target).hasClass('modal')) {
            $('.modal').css('display', 'none');
          }
        });
  
        $('#prev-page').click(function(e) {
          e.preventDefault();
          if (currentPage > 1) {
            currentPage--;
            renderTable();
          }
        });
  
        $('#next-page').click(function(e) {
          e.preventDefault();
          const totalPages = Math.ceil(booksData.length / rowsPerPage);
          if (currentPage < totalPages) {
            currentPage++;
            renderTable();
          }
        });
  
        $('#rows-per-page').change(function() {
          rowsPerPage = parseInt($(this).val());
          currentPage = 1;
          renderTable();
        });
  
        $('.sort-icon').click(function() {
          const column = $(this).data('column');
          if (sortColumn === column) {
            sortOrder = sortOrder === 'asc' ? 'desc' : 'asc';
          } else {
            sortColumn = column;
            sortOrder = 'asc';
          }
          renderTable();
        });
  
        $('.column-filter-icon').click(function(e) {
          e.stopPropagation();
          const dropdown = $(this).siblings('.column-filter-dropdown');
          $('.column-filter-dropdown').not(dropdown).hide();
          dropdown.toggle();
        });
  
        $(document).click(function() {
          $('.column-filter-dropdown').hide();
        });
  
        $('.column-filter-dropdown').click(function(e) {
          e.stopPropagation();
        });
  
        $('.column-filter-dropdown button').click(function() {
          const column = $(this).closest('.column-filter').find('.column-filter-icon').data('column');
          const value = $(this).siblings('input, select').val();
          if (value) {
            filters[column] = value;
          } else {
            delete filters[column];
          }
          currentPage = 1;
          renderTable();
          $(this).closest('.column-filter-dropdown').hide();
        });
  
        $('.search-bar input').on('input', function() {
          const searchTerm = $(this).val().toLowerCase();
          filters['title'] = searchTerm;
          currentPage = 1;
          renderTable();
        });
  
        $('.category-filter select').change(function() {
          const category = $(this).val();
          if (category) {
            filters['category'] = category;
          } else {
            delete filters['category'];
          }
          currentPage = 1;
          renderTable();
        });
  
        $('.add-book-btn').click(function() {
          $('#addBookModal').css('display', 'block');
        });
  
        $('#addBookForm').submit(function(e) {
          e.preventDefault();
          const newBook = {
            isbn: $('#addIsbn').val(),
            title: $('#addTitle').val(),
            author: $('#addAuthor').val(),
            category: $('#addCategory').val(),
            price: parseFloat($('#addPrice').val()),
            stock: parseInt($('#addStock').val()),
            description: $('#addDescription').val(),
            coverImage: $('#addCoverImage').val()
          };
          booksData.push(newBook);
          renderTable();
          $('#addBookModal').css('display', 'none');
          this.reset();
        });
  
        $('#editBookForm').submit(function(e) {
          e.preventDefault();
          const isbn = $('#editIsbn').val();
          const bookIndex = booksData.findIndex(b => b.isbn === isbn);
          if (bookIndex !== -1) {
            booksData[bookIndex] = {
              isbn: isbn,
              title: $('#editTitle').val(),
              author: $('#editAuthor').val(),
              category: $('#editCategory').val(),
              price: parseFloat($('#editPrice').val()),
              stock: parseInt($('#editStock').val()),
              description: $('#editDescription').val(),
              coverImage: $('#editCoverImage').val()
            };
            renderTable();
            $('#editBookModal').css('display', 'none');
          }
        });
  
        $('#books-table').on('click', '.btn-delete', function() {
          const isbn = $(this).data('isbn');
          if (confirm('Are you sure you want to delete this book?')) {
            const bookIndex = booksData.findIndex(b => b.isbn === isbn);
            if (bookIndex !== -1) {
              booksData.splice(bookIndex, 1);
              renderTable();
            }
          }
        });
  
        $('.export-btn').click(function() {
          let csv = 'ISBN,Title,Author,Category,Price,Stock\n';
          booksData.forEach(book => {
            csv += `${book.isbn},"${book.title}","${book.author}",${book.category},${book.price},${book.stock}\n`;
          });
          const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
          const link = document.createElement('a');
          if (link.download !== undefined) {
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'books_export.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
          }
        });
  
        // Initial render
        renderTable();
      });
    </script>
  </body>
  </html>